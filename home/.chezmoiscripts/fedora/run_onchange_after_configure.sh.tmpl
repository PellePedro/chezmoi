#!/bin/bash

set -eufo pipefail

# Run common scripts
{{ template "common/run_onchange_after_install-core-tools.sh.tmpl" . }}
{{ template "common/run_onchange_after_install-go-tools.sh.tmpl" . }}
{{ template "common/run_onchange_after_install-java-tools.sh.tmpl" . }}

log() {
  printf "[CHEZMOI] %s\n" "$@"
}

# Fedora-specific post-configuration

# Install Oh My Zsh if not present
if [ ! -d "$HOME/.oh-my-zsh" ] && command -v zsh &> /dev/null; then
  log "Installing Oh My Zsh..."
  sh -c "$(curl -fsSL https://raw.githubusercontent.com/ohmyzsh/ohmyzsh/master/tools/install.sh)" "" --unattended || true
fi

# Change default shell to zsh if available
if command -v zsh &> /dev/null && [ "$SHELL" != "$(which zsh)" ]; then
  log "Changing default shell to zsh..."
  sudo chsh -s "$(which zsh)" "$USER" || true
fi

log "Fedora configuration completed!"